#!/usr/bin/env node

/*
 * Copyright (c) 2014 Rob Gulewich. All rights reserved.
 *
 * Ramsey: the suburban commando for templating your text files
 */

var dashdash = require('dashdash');
var template = require('../lib/template');



// --- Globals



var OPTIONS = [
    {
        names: ['dir', 'd'],
        type: 'string',
        help: 'directory of input files'
    },
    {
        names: ['file', 'f'],
        type: 'string',
        help: 'JSON input file'
    }
];



// --- Main


function usage(msg) {
    var text = [
        'ramsey -d <template directory> <input file> <output file>'
    ];

    if (msg) {
        text.unshift(msg);
    }

    console.error(text.join('\n'));
    process.exit(1);
}



// --- Main



var opts;
var parser = dashdash.createParser({ options: OPTIONS });

try {
    opts = parser.parse(process.argv);
} catch (e) {
    console.error('error: %s', e.message);
    process.exit(1);
}

if (opts._args.length !== 2) {
    usage('Must specify input and output file!');
}

if (!opts.hasOwnProperty('dir') && !opts.hasOwnProperty('file')) {
    usage('Must specify template directory or file!');
}

template.generateFile({
    dir: opts.dir,
    file: opts.file,
    inFile: opts._args[0],
    outFile: opts._args[1]
});
